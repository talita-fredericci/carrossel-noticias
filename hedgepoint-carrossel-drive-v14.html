<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hedgepoint | Carrossel (Crachá v14.1)</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --hp-orange:#ED8B00; --hp-black:#000; --hp-white:#fff; --hp-gray:#4D4C4D;
    --card-w: clamp(300px, 44vw, 420px);     /* largura do crachá */
    --media-h: clamp(320px, 48vh, 440px);    /* altura da foto */
    --gap: 16px; --radius: 10px; --tag-radius: 8px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Montserrat",system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Open Sans","Helvetica Neue",Arial,sans-serif;color:var(--hp-black);background:var(--hp-white)}
  .hp-wrap{--pad:clamp(10px,2vw,18px);max-width:1000px;margin:0 auto;padding:var(--pad)}
  .hp-title{font-weight:800;letter-spacing:.2px;font-size:clamp(18px,2.2vw,22px);margin-bottom:10px}

  /* 1 card por vez, centralizado */
  .hp-track{
    display:grid; grid-auto-flow:column; grid-auto-columns:min(var(--card-w), 100%);
    justify-content:center; gap:var(--gap);
    overflow-x:auto; scroll-snap-type:x mandatory; scroll-behavior:smooth;
    padding:4px 6px 12px;
  }
  .hp-track::-webkit-scrollbar{height:8px}
  .hp-track::-webkit-scrollbar-thumb{background:#ddd;border-radius:999px}

  .hp-card{
    width:100%; scroll-snap-align:center; position:relative;
    border:1px solid #e9e9e9; border-radius:var(--radius); overflow:hidden;
    background:var(--hp-white); box-shadow:0 2px 14px rgba(0,0,0,.07);
    display:flex; flex-direction:column;
  }

  /* Foto alta */
  .hp-media{height:var(--media-h); background:#f6f6f6; overflow:hidden}
  .hp-media img{width:100%; height:100%; object-fit:cover; object-position:center 42%; display:block}

  /* Faixa laranja (nome + cargo) */
  .hp-ribbon{background:var(--hp-orange); color:#fff; padding:16px 18px 13px}
  .hp-name{font-size:clamp(22px,2.6vw,26px); font-weight:900; line-height:1.06; margin:0 0 6px}
  .hp-role{font-size:clamp(12px,1.55vw,14px); font-weight:600; opacity:.98; margin:0}

  /* Corpo */
  .hp-body{padding:14px 16px 16px; display:flex; flex-direction:column; gap:12px}
  .hp-tag{align-self:flex-start; background:#fff; color:var(--hp-orange); border:2px solid var(--hp-orange);
         border-radius:var(--tag-radius); font-weight:800; font-size:12px; padding:6px 12px; letter-spacing:.3px}
  .hp-news-title{font-size:clamp(16px,2.05vw,19px); line-height:1.26; font-weight:800; margin:0}
  .hp-news-title a{color:inherit; text-decoration:none}
  .hp-news-title a:hover{opacity:.9; text-decoration:underline}
  .hp-meta{display:flex; align-items:center; gap:10px; margin-top:2px; color:var(--hp-gray)}
  .hp-meta img{width:18px; height:18px; border-radius:4px; flex:0 0 18px}
  .hp-source a{color:inherit; text-decoration:none; border-bottom:1px solid #ddd}
  .hp-source a:hover{border-bottom-color:#000}

  .hp-empty{padding:14px; border:1px dashed #ddd; border-radius:8px; background:#fafafa; color:#666; text-align:center}
</style>
</head>
<body>
<div class="hp-wrap" role="region" aria-label="Carrossel de notícias da Hedgepoint">
  <div class="hp-title">Insights da nossa equipe &amp; na mídia</div>
  <div class="hp-track" id="hpTrack" aria-live="polite"></div>
  <div id="hpStatus" class="hp-empty" style="display:none"></div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQriFFRu5l_lZvXyKLkk_C32g79FhADcf2XEw9FPUqkd5cg-k_csA5ctbFivtY7TUd8jWTWF2zM95TM/pub?output=csv";
const AUTO_ADVANCE_MS = 5000;

/* Helpers */
async function fetchCSVUtf8(url){
  const res = await fetch(url, {cache:"no-store"});
  if(!res.ok) throw new Error("Falha ao carregar CSV");
  const buf = await res.arrayBuffer();
  return new TextDecoder("utf-8").decode(buf);
}
function countDelims(line, delim){let q=false,c=0;for(let i=0;i<line.length;i++){const ch=line[i];if(ch=='"'){q=!q;continue;}if(!q&&ch===delim)c++;}return c;}
function sniffDelimiter(text){
  const lines=text.split(/\r?\n/).filter(l=>l.trim()).slice(0,3);
  let comma=0,semi=0; for(const l of lines){comma+=countDelims(l,',');semi+=countDelims(l,';');}
  return semi>comma?';':',';
}
function parseCSV(text,dl){const rows=[],DL=dl;let i=0,f='',r=[],q=false;const pf=()=>{r.push(f);f='';},pr=()=>{rows.push(r);r=[];};
  while(i<text.length){const ch=text[i];
    if(q){if(ch=='"'){if(text[i+1]=='"'){f+='"';i++;}else{q=false;}}else{f+=ch;}}
    else{if(ch=='"'){q=true;}else if(ch===DL){pf();}else if(ch=='\n'){pf();pr();}else if(ch!='\r'){f+=ch;}}
    i++;
  } if(f.length||r.length){pf();pr();} return rows;
}
function getFavicon(url){try{const u=new URL(url);return `https://www.google.com/s2/favicons?sz=32&domain=${u.hostname}`;}catch{return `https://www.google.com/s2/favicons?sz=32&domain=example.com`;}}
const get = (row, idx) => (idx>=0 ? (row[idx] ?? '') : '');

/* Card */
function createCard({Titulo, Veiculo, Commodity, Foto, Link, Especialista, Cargo}){
  const card=document.createElement('article'); card.className='hp-card';

  const media=document.createElement('div'); media.className='hp-media';
  const img=document.createElement('img'); img.loading='lazy'; img.alt=Especialista||''; img.src=Foto||''; media.appendChild(img);

  const ribbon=document.createElement('div'); ribbon.className='hp-ribbon';
  const hName=document.createElement('h3'); hName.className='hp-name'; hName.textContent=(Especialista||'').trim();
  const pRole=document.createElement('p'); pRole.className='hp-role'; pRole.textContent=(Cargo||'').trim();
  ribbon.appendChild(hName); if(pRole.textContent) ribbon.appendChild(pRole);

  const body=document.createElement('div'); body.className='hp-body';
  const tag=document.createElement('span'); tag.className='hp-tag'; tag.textContent=(Commodity||'').toUpperCase();

  const hTitle=document.createElement('h4'); hTitle.className='hp-news-title';
  const a=document.createElement('a'); a.href=Link||'#'; a.target='_blank'; a.rel='noopener noreferrer'; a.textContent=Titulo||'';
  hTitle.appendChild(a);

  const meta=document.createElement('div'); meta.className='hp-meta';
  const fav=document.createElement('img'); fav.src=getFavicon(Link||''); fav.alt='';
  const source=document.createElement('span'); source.className='hp-source';
  const aSrc=document.createElement('a'); aSrc.href=Link||'#'; aSrc.target='_blank'; aSrc.rel='noopener noreferrer'; aSrc.textContent=Veiculo||'';
  source.appendChild(aSrc); meta.append(fav, source);

  body.append(tag, hTitle, meta);
  card.append(media, ribbon, body);
  return card;
}

/* Init + autoplay robusto */
async function init(){
  const track=document.getElementById('hpTrack');
  const status=document.getElementById('hpStatus');

  try{
    const raw=await fetchCSVUtf8(CSV_URL);
    const delim=sniffDelimiter(raw);
    const rows=parseCSV(raw,delim).filter(r=>r.length && r.some(c=>c && String(c).trim()!==''));
    if(rows.length<2){status.style.display='block';status.textContent='Nenhuma notícia para exibir no momento.';return;}

    const header=rows[0].map(h=>(h||'').trim());
    const col = rx => header.findIndex(h => rx.test(h));
    const idx={
      Titulo: col(/^t[ií]tulo|^titulo|^t[íi]tulo/i),
      Veiculo: col(/^(ve[ií]culo|veiculo|fonte|source|portal|site)/i),
      Commodity: col(/^(commodity|mercadoria|categoria|tag)/i),
      Foto: col(/^(foto|imagem|image|headshot|photo)/i),
      Link: col(/^(link|url)/i),
      Especialista: col(/^(especialista|especialistas|nome|analista|autor)/i),
      Cargo: col(/^(cargo|t[ií]tulo profissional|posição|posicao|role)/i)
    };

    for(let r=1;r<rows.length;r++){
      const row=rows[r];
      const data={
        Titulo: get(row, idx.Titulo),
        Veiculo: get(row, idx.Veiculo),
        Commodity: get(row, idx.Commodity),
        Foto: get(row, idx.Foto),
        Link: get(row, idx.Link),
        Especialista: get(row, idx.Especialista),
        Cargo: get(row, idx.Cargo)
      };
      track.appendChild(createCard(data));
    }

    /* autoplay – pausa apenas no hover, reinicia sempre */
    let timer=null;
    const step = () => {
      const first=track.firstElementChild;
      if(!first) return track.clientWidth;
      const gap=parseFloat(getComputedStyle(track).gap||'0');
      return first.getBoundingClientRect().width + gap;
    };
    const atEnd = () => Math.abs(track.scrollWidth - track.clientWidth - track.scrollLeft) < 2;

    const start = () => { stop(); timer=setInterval(()=> {
      if(atEnd()) track.scrollTo({left:0,behavior:'smooth'});
      else track.scrollBy({left:step(),behavior:'smooth'});
    }, AUTO_ADVANCE_MS); };
    const stop = () => { if(timer) clearInterval(timer); };

    start();
    track.addEventListener('pointerenter', stop);
    track.addEventListener('pointerleave', start);
    track.addEventListener('scroll', () => { /* se usuário mexer, reinicia o timer */
      stop(); clearTimeout(track._t); track._t=setTimeout(start, 1200);
    });

  }catch(err){
    status.style.display='block';
    status.textContent='Não foi possível carregar os dados agora. Verifique o caminho do CSV.';
    console.error(err);
  }
}
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
